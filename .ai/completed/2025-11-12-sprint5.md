# Sprint #5 - SEO & Performance

**Started**: 2025-11-12
**Estimated**: 2.5 hours
**Status**: COMPLETED
**Ended**: 2025-11-12
**Actual**: ~1.5 hours
**Priority**: High

## Objective
Improve search engine optimization (SEO) and performance with dynamic sitemap generation, metadata helpers, structured data, and optimized image handling.

## Tasks

### SEO Implementation
- [x] Create app/sitemap.ts [P1]
  - Commit: `85a580c` (from Sprint #3)
  - Dynamic sitemap generation from Rush CMS
  - Includes static pages (home, blog, contact)
  - Fetches blog entries dynamically
  - Proper lastModified, changeFrequency, priority
  - Error handling for API failures
- [x] Create app/robots.ts [P1]
  - Commit: `85a580c` (from Sprint #3)
  - User-agent: * with allow: /
  - Disallows /api/ and /admin/ routes
  - Links to sitemap.xml
- [x] Create lib/metadata.ts helpers [P1]
  - Commit: `569c584`
  - generatePageMetadata() for static pages
  - generateEntryMetadata() for any collection entries (blog, pages, etc)
  - Generic with custom extractors (getTitleFn, getDescriptionFn, etc)
  - generateOgImage() for dynamic OG images
  - Type-safe metadata generation with TypeScript generics
  - Supports both 'article' and 'website' OpenGraph types
- [x] Add JSON-LD structured data [P2]
  - Commit: `569c584`
  - components/structured-data/entry-schema.tsx
  - ArticleSchema component (Schema.org Article)
  - WebPageSchema component (Schema.org WebPage)
  - BreadcrumbSchema component (Schema.org BreadcrumbList)
  - Generic with custom extractors for any collection type
  - Integrated into Article component with opt-in prop

### Performance Optimization
- [x] Create components/ui/optimized-image.tsx [P2]
  - Commit: `569c584`
  - Wrapper for next/image with sensible defaults
  - Blur placeholder support (with blurDataURL)
  - Responsive sizes configuration
  - Aspect ratio presets (square, 16:9, 4:3, 3:2, 21:9)
  - Object-fit options (cover, contain, fill, none)
  - Lazy loading by default (with priority override)
  - Type-safe props extending Next.js ImageProps

### Integration
- [x] Updated app/page.tsx with generatePageMetadata
- [x] Updated app/blog/page.tsx with generatePageMetadata
- [x] Updated app/blog/[slug]/page.tsx with generateEntryMetadata
- [x] Integrated ArticleSchema and BreadcrumbSchema into Article component
- [x] Added author field to BlogEntryData type

## Dependencies
- Sprint #3 completed (sitemap and robots.ts created)
- Sprint #4 completed (analytics and revalidation)
- Next.js 16 metadata API
- next/image component

## Technical Notes
- Sitemap and robots.ts already exist from Sprint #3
- Follow CLAUDE.md rules: single quotes, no semicolons, tabs (size 4)
- Use Next.js 16 Metadata API for generateMetadata
- JSON-LD should be injected in <head> via Script component
- Use next/image for automatic optimization
- Blur placeholders improve perceived performance
- **Generic Design**: All helpers work with ANY Rush CMS collection, not just blog posts

## Key Innovation
Created a **generic metadata and structured data system** that adapts to any Rush CMS collection type through custom extractor functions. This means the same helpers work for blog posts, pages, products, real estate listings, or any custom collection without modification.

Example usage:
```typescript
// For blog posts
generateEntryMetadata<BlogEntryData>({
  entry,
  getTitleFn: (data) => data.title,
  getImageFn: (data) => data.featured_image
})

// For products (hypothetical)
generateEntryMetadata<ProductData>({
  entry,
  getTitleFn: (data) => data.product_name,
  getImageFn: (data) => data.main_photo
})
```

## Implementation Plan

1. **Metadata Helpers** (1h) ✅
   - Create `src/lib/metadata.ts`
   - generatePageMetadata() for static pages
   - generateEntryMetadata() for collection entries
   - OpenGraph and Twitter Card support
   - Type-safe with TypeScript generics

2. **Structured Data** (0.75h) ✅
   - Create `src/components/structured-data/entry-schema.tsx`
   - Schema.org Article type
   - Schema.org WebPage type
   - Schema.org BreadcrumbList type
   - JSON-LD format
   - Integrate into Article component

3. **Optimized Image Component** (0.75h) ✅
   - Create `src/components/ui/optimized-image.tsx`
   - Wrap next/image with sensible defaults
   - Support blur placeholders
   - Responsive sizes prop
   - Aspect ratio presets

## Definition of Done Checklist
- [x] Sitemap.ts created and generates dynamic entries
- [x] Robots.ts created with proper rules
- [x] Metadata helpers created and type-safe
- [x] Entries have JSON-LD structured data (generic for all collections)
- [x] OptimizedImage component created
- [x] TypeScript compiles without errors: `pnpm type-check`
- [x] Code follows CLAUDE.md guidelines
- [x] All commits follow conventional commit format

### Sprint Metrics
- **Velocity**: 8/8 tasks (100%)
- **Time Accuracy**: 1.5h / 2.5h = 60% (faster than estimated)
- **Blockers**: 0

**Notes**:
- Sprint completed successfully with all objectives met
- Created generic metadata and structured data helpers that work with ANY Rush CMS collection
- Metadata helpers use TypeScript generics with custom extractors for flexibility
- ArticleSchema, WebPageSchema, and BreadcrumbSchema components for SEO
- OptimizedImage component with aspect ratio presets and blur placeholder support
- All code type-safe and follows CLAUDE.md guidelines
- Sitemap and robots.ts already existed from Sprint #3
- Commit: `569c584` - feat: add seo metadata helpers and structured data for collections
